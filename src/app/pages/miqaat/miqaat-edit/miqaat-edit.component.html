<div class="container-fluid py-3">
  <div class="row">
    <div class="col-12">
      <div
        class="page-title-box d-flex align-items-center justify-content-between mr-4 ml-4"
      >
        <h4 class="mb-0">Edit Miqaat</h4>
        <div class="page-title-right">
          <button (click)="goBack()" type="button" class="btn btn-info btn-sm">
            <i class="ri-arrow-left-line align-middle mr-2"></i>Back
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <form [formGroup]="miqaatForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <div class="col-md-6">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-label-group">
                      <input
                        type="text"
                        class="form-control"
                        id="miqaatName"
                        formControlName="miqaatName"
                        placeholder="Enter Miqaat Name"
                        [class.is-invalid]="
                          f.miqaatName.invalid &&
                          (f.miqaatName.dirty || f.miqaatName.touched)
                        "
                      />
                      <label class="form-label"
                        >Miqaat Name <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.miqaatName.invalid &&
                        (f.miqaatName.dirty || f.miqaatName.touched)
                      "
                    >
                      <div *ngIf="f.miqaatName.errors?.['required']">
                        Miqaat Name is required
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <input
                        type="text"
                        class="form-control"
                        id="jamaat"
                        formControlName="jamaat"
                        placeholder="Enter Jamaat"
                        [class.is-invalid]="
                          f.jamaat.invalid &&
                          (f.jamaat.dirty || f.jamaat.touched)
                        "
                      />
                      <label class="form-label"
                        >Jamaat <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.jamaat.invalid &&
                        (f.jamaat.dirty || f.jamaat.touched)
                      "
                    >
                      <div *ngIf="f.jamaat.errors?.['required']">
                        Jamaat is required
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <input
                        type="text"
                        class="form-control"
                        id="jamiyat"
                        formControlName="jamiyat"
                        placeholder="Enter Jamiyat"
                        [class.is-invalid]="
                          f.jamiyat.invalid &&
                          (f.jamiyat.dirty || f.jamiyat.touched)
                        "
                      />
                      <label class="form-label"
                        >Jamiyat <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.jamiyat.invalid &&
                        (f.jamiyat.dirty || f.jamiyat.touched)
                      "
                    >
                      <div *ngIf="f.jamiyat.errors?.['required']">
                        Jamiyat is required
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <input
                        type="date"
                        class="form-control"
                        id="fromDate"
                        formControlName="fromDate"
                        [class.is-invalid]="
                          f.fromDate.invalid &&
                          (f.fromDate.dirty || f.fromDate.touched)
                        "
                      />
                      <label class="form-label"
                        >From Date <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.fromDate.invalid &&
                        (f.fromDate.dirty || f.fromDate.touched)
                      "
                    >
                      <div *ngIf="f.fromDate.errors?.['required']">
                        From Date is required
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <input
                        type="date"
                        class="form-control"
                        id="tillDate"
                        formControlName="tillDate"
                        [class.is-invalid]="
                          f.tillDate.invalid &&
                          (f.tillDate.dirty || f.tillDate.touched)
                        "
                      />
                      <label class="form-label"
                        >Till Date <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.tillDate.invalid &&
                        (f.tillDate.dirty || f.tillDate.touched)
                      "
                    >
                      <div *ngIf="f.tillDate.errors?.['required']">
                        Till Date is required
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <input
                        type="number"
                        class="form-control"
                        id="volunteerLimit"
                        formControlName="volunteerLimit"
                        placeholder="Enter Volunteer Limit"
                        min="1"
                        [class.is-invalid]="
                          f.volunteerLimit.invalid &&
                          (f.volunteerLimit.dirty || f.volunteerLimit.touched)
                        "
                      />
                      <label class="form-label"
                        >Volunteer Limit
                        <span class="text-danger">*</span></label
                      >
                    </div>
                    <div
                      class="invalid-feedback d-block"
                      *ngIf="
                        f.volunteerLimit.invalid &&
                        (f.volunteerLimit.dirty || f.volunteerLimit.touched)
                      "
                    >
                      <div *ngIf="f.volunteerLimit.errors?.['required']">
                        Volunteer Limit is required
                      </div>
                      <div *ngIf="f.volunteerLimit.errors?.['min']">
                        Volunteer Limit must be at least 1
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-label-group">
                      <select
                        class="form-control"
                        id="adminApproval"
                        formControlName="adminApproval"
                      >
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                      </select>
                      <label class="form-label">Approval Status</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="row">
                  <div class="col-md-12">
                    <div class="form-label-group">
                      <textarea
                        class="form-control"
                        id="aboutMiqaat"
                        formControlName="aboutMiqaat"
                        placeholder="Enter About Miqaat"
                        rows="8"
                        maxlength="500"
                      ></textarea>
                      <label class="form-label">About Miqaat</label>
                      <small class="form-text text-muted">
                        {{
                          miqaatForm.get("aboutMiqaat")?.value?.length || 0
                        }}/500 characters
                      </small>
                    </div>
                  </div>

                  <div class="col-md-12 mt-3">
                    <div class="card bg-light">
                      <div class="card-body">
                        <h6 class="card-title">Miqaat Information</h6>
                        <p class="mb-1">
                          <strong>Created By:</strong>
                          {{ miqaatData?.captainName || "N/A" }}
                        </p>
                        <p class="mb-1" *ngIf="miqaatData?.createdAt">
                          <strong>Created At:</strong>
                          {{
                            moment(miqaatData.createdAt).format(
                              "DD MMM YYYY HH:mm"
                            )
                          }}
                        </p>
                        <p class="mb-0" *ngIf="miqaatData?.updatedAt">
                          <strong>Last Updated:</strong>
                          {{
                            moment(miqaatData.updatedAt).format(
                              "DD MMM YYYY HH:mm"
                            )
                          }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-12 text-end">
                <button
                  type="button"
                  class="btn btn-secondary mr-2"
                  (click)="goBack()"
                  [disabled]="isBtnLoading"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="btn btn-primary"
                  [disabled]="isBtnLoading || miqaatForm.invalid"
                >
                  <span
                    *ngIf="isBtnLoading"
                    class="spinner-border spinner-border-sm me-1"
                    role="status"
                    aria-hidden="true"
                  ></span>
                  <i *ngIf="!isBtnLoading" class="ri-save-line mr-1"></i>
                  {{ isBtnLoading ? "Saving..." : "Save Changes" }}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

