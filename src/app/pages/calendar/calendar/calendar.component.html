<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-sm-flex align-items-center justify-content-between">
        <h4 class="mb-sm-0 font-size-18">Appointments Calendar</h4>
        <div class="page-title-right">
          <ol class="breadcrumb m-0">
            <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard</a></li>
            <li class="breadcrumb-item active">Calendar</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Legend and Controls Row -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body py-3">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h6 class="mb-2 text-muted">Status Legend:</h6>
              <div class="d-flex flex-wrap gap-3">
                <span class="badge badge-soft-success px-3 py-2 mr-1">
                  <i class="ri-check-line mr-1"></i>Confirmed
                </span>
                <span class="badge badge-soft-warning px-3 py-2 mr-1">
                  <i class="ri-time-line mr-1"></i>Pending
                </span>
                <span class="badge badge-soft-danger px-3 py-2 mr-1">
                  <i class="ri-close-line mr-1"></i>Cancelled
                </span>
                <span class="badge badge-soft-info px-3 py-2">
                  <i class="ri-check-double-line mr-1"></i>Completed
                </span>
              </div>
            </div>
            <div class="col-md-6 text-md-end">
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-soft-primary btn-sm" (click)="refreshCalendar()">
                  <i class="ri-refresh-line mr-1"></i> Refresh
                </button>
                <button type="button" class="btn btn-soft-info btn-sm" (click)="goToToday()">
                  <i class="ri-calendar-today-line mr-1"></i> Today
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calendar Row -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <!-- Loading Indicator -->
          <div *ngIf="isLoading" class="text-center py-5">
            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted">Loading appointments...</p>
          </div>

          <!-- Calendar -->
          <div *ngIf="!isLoading" class="calendar-container">
            <full-calendar 
              #calendar
              [plugins]="calendarPlugins"
              [header]="header"
              [buttonText]="buttonText"
              [defaultView]="defaultView"
              [editable]="editable"
              [selectable]="selectable"
              [selectMirror]="selectMirror"
              [weekends]="weekends"
              [eventLimit]="eventLimit"
              [height]="height"
              [minTime]="minTime"
              [maxTime]="maxTime"
              [allDaySlot]="allDaySlot"
              [events]="events"
              (eventClick)="handleEventClick($event)"
              (dateClick)="handleDateClick($event)"
              (eventMouseEnter)="handleEventMouseEnter($event)"
              (eventMouseLeave)="handleEventMouseLeave($event)">
            </full-calendar>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards Row -->
  <div class="row mt-4" *ngIf="!isLoading && appointments.length > 0">
    <div class="col-xl-3 col-md-6">
      <div class="card card-h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-6">
              <span class="text-muted mb-3 lh-1 d-block text-truncate">Total Appointments</span>
              <h4 class="mb-3">
                <span class="counter-value">{{ appointments.length }}</span>
              </h4>
            </div>
            <div class="col-6">
              <div id="mini-chart1" data-colors='["#5156be"]' class="apex-charts text-end">
                <div class="avatar-sm mx-auto">
                  <span class="avatar-title rounded-circle bg-primary">
                    <i class="ri-calendar-check-line font-size-20"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="card card-h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-6">
              <span class="text-muted mb-3 lh-1 d-block text-truncate">Confirmed</span>
              <h4 class="mb-3">
                <span class="counter-value">{{ getAppointmentCountByStatus(1) }}</span>
              </h4>
            </div>
            <div class="col-6">
              <div class="avatar-sm mx-auto">
                <span class="avatar-title rounded-circle bg-success">
                  <i class="ri-check-line font-size-20"></i>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="card card-h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-6">
              <span class="text-muted mb-3 lh-1 d-block text-truncate">Pending</span>
              <h4 class="mb-3">
                <span class="counter-value">{{ getAppointmentCountByStatus(2) }}</span>
              </h4>
            </div>
            <div class="col-6">
              <div class="avatar-sm mx-auto">
                <span class="avatar-title rounded-circle bg-warning">
                  <i class="ri-time-line font-size-20"></i>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xl-3 col-md-6">
      <div class="card card-h-100">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-6">
              <span class="text-muted mb-3 lh-1 d-block text-truncate">New Clients</span>
              <h4 class="mb-3">
                <span class="counter-value">{{ getNewClientCount() }}</span>
              </h4>
            </div>
            <div class="col-6">
              <div class="avatar-sm mx-auto">
                <span class="avatar-title rounded-circle bg-info">
                  <i class="ri-user-add-line font-size-20"></i>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
